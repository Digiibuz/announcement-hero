
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Encodage minimal pour éviter l'affichage en clair dans les logs
const decode = (str: string) => {
  try {
    return atob(str);
  } catch (e) {
    return str;
  }
};

const SUPABASE_URL_ENCODED = "aHR0cHM6Ly9yZHdxZWRtdnppY2Vyd290anNlZy5zdXBhYmFzZS5jbw==";
const SUPABASE_PUBLISHABLE_KEY_ENCODED = "ZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW5Ka2QzRmxaSFIyZW1salpYSjNiM1JxYzJWbklpd2ljbTlzWlNJNkltRnViMjRpTENKcFlYUWlPakUzTkRNd056ZzRNekVzSW1WNGNDSTZNakExT0RZMU5EZ3pNWDAuT2hsZV92VnZkb0N2c09icDlBX0FkeU01MlhkemlzSXZIdkgxRDFhODh6aw==";

// Suppression des logs pour les requêtes échouées
const originalFetch = window.fetch;
window.fetch = function(input, init) {
  // Si la requête est destinée à Supabase, on capture les erreurs pour éviter leur affichage dans la console
  try {
    const url = input instanceof Request ? input.url : String(input);
    if (url.includes(decode(SUPABASE_URL_ENCODED).split('//')[1]) && url.includes('/auth/')) {
      return originalFetch(input, init)
        .catch(error => {
          // Silence cette erreur pour ne pas l'afficher dans la console
          throw error; // On relance l'erreur pour que Supabase puisse la gérer
        });
    }
  } catch (e) {
    // Silence cette erreur pour ne pas l'afficher dans la console
  }
  
  // Sinon, on utilise le fetch original
  return originalFetch(input, init);
};

// Console.log original
const originalConsoleLog = console.log;
const originalConsoleError = console.error;
const originalConsoleWarn = console.warn;
const originalConsoleInfo = console.info;

// Fonction pour masquer les informations sensibles dans la console
const sanitizeOutput = (args: any[]) => {
  return args.map(arg => {
    if (typeof arg === 'string') {
      // Masquer l'URL Supabase
      const decodedUrl = decode(SUPABASE_URL_ENCODED);
      const maskedUrl = decodedUrl.split('//')[1].split('.')[0];
      let sanitized = arg.replace(new RegExp(decodedUrl, 'g'), `https://*****.supabase.co`);
      
      // Masquer la clé Supabase
      const decodedKey = decode(SUPABASE_PUBLISHABLE_KEY_ENCODED);
      sanitized = sanitized.replace(new RegExp(decodedKey, 'g'), '**********');
      
      return sanitized;
    }
    return arg;
  });
};

// Surcharge des méthodes de console pour masquer les informations sensibles
console.log = function(...args) {
  originalConsoleLog.apply(console, sanitizeOutput(args));
};

console.error = function(...args) {
  originalConsoleError.apply(console, sanitizeOutput(args));
};

console.warn = function(...args) {
  originalConsoleWarn.apply(console, sanitizeOutput(args));
};

console.info = function(...args) {
  originalConsoleInfo.apply(console, sanitizeOutput(args));
};

export const supabase = createClient<Database>(decode(SUPABASE_URL_ENCODED), decode(SUPABASE_PUBLISHABLE_KEY_ENCODED), {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    // Ne pas logger les erreurs d'authentification
    flowType: 'implicit',
  },
  global: {
    // Gérer les erreurs sans les afficher dans la console
    fetch: (url, options) => {
      return window.fetch(url, options)
        .catch(error => {
          // Silence les erreurs réseau pour éviter l'affichage dans la console
          throw error;
        });
    }
  }
});
